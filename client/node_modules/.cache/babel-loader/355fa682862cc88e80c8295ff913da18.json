{"ast":null,"code":"var Document = require('../document');\n\nvar PromiseProvider = require('../promise_provider');\n\nmodule.exports = Subdocument;\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields) {\n  this.$isSingleNested = true;\n  Document.call(this, value, fields);\n}\n\nSubdocument.prototype = Object.create(Document.prototype);\n\nSubdocument.prototype.toBSON = function () {\n  return this.toObject({\n    transform: false,\n    virtuals: false\n  });\n};\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\n\nSubdocument.prototype.save = function (fn) {\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function (resolve) {\n    fn && fn();\n    resolve();\n  });\n};\n\nSubdocument.prototype.$isValid = function (path) {\n  if (this.$parent) {\n    return this.$parent.$isValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.markModified = function (path) {\n  Document.prototype.markModified.call(this, path);\n\n  if (this.$parent) {\n    if (this.$parent.isDirectModified(this.$basePath)) {\n      return;\n    }\n\n    this.$parent.markModified([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.$markValid = function (path) {\n  Document.prototype.$markValid.call(this, path);\n\n  if (this.$parent) {\n    this.$parent.$markValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.invalidate = function (path, err, val) {\n  Document.prototype.invalidate.call(this, path, err, val);\n\n  if (this.$parent) {\n    this.$parent.invalidate([this.$basePath, path].join('.'), err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError') {\n    throw err;\n  }\n};\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\n\nSubdocument.prototype.ownerDocument = function () {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  var parent = this.$parent;\n\n  if (!parent) {\n    return this;\n  }\n\n  while (parent.$parent || parent.__parent) {\n    parent = parent.$parent || parent.__parent;\n  }\n\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n/**\n * Null-out this subdoc\n *\n * @param {Object} [options]\n * @param {Function} [callback] optional callback for compatibility with Document.prototype.remove\n */\n\n\nSubdocument.prototype.remove = function (options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  } // If removing entire doc, no need to remove subdoc\n\n\n  if (!options || !options.noop) {\n    this.$parent.set(this.$basePath, null);\n    registerRemoveListener(this);\n  }\n\n  if (typeof callback === 'function') {\n    callback(null);\n  }\n};\n/*!\n * ignore\n */\n\n\nSubdocument.prototype.populate = function () {\n  throw new Error('Mongoose does not support calling populate() on nested ' + 'docs. Instead of `doc.nested.populate(\"path\")`, use ' + '`doc.populate(\"nested.path\")`');\n};\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\n\nfunction registerRemoveListener(sub) {\n  var owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    owner = sub = null;\n  }\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}","map":{"version":3,"sources":["C:/Users/SATAN/darelist/client/node_modules/mongoose/lib/types/subdocument.js"],"names":["Document","require","PromiseProvider","module","exports","Subdocument","value","fields","$isSingleNested","call","prototype","Object","create","toBSON","toObject","transform","virtuals","save","fn","Promise","get","ES6","resolve","$isValid","path","$parent","$basePath","join","markModified","isDirectModified","$markValid","invalidate","err","val","kind","name","ownerDocument","$__","parent","__parent","remove","options","callback","noop","set","registerRemoveListener","populate","Error","sub","owner","emitRemove","removeListener","emit","on"],"mappings":"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","sourcesContent":["var Document = require('../document');\nvar PromiseProvider = require('../promise_provider');\n\nmodule.exports = Subdocument;\n\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields) {\n  this.$isSingleNested = true;\n  Document.call(this, value, fields);\n}\n\nSubdocument.prototype = Object.create(Document.prototype);\n\nSubdocument.prototype.toBSON = function() {\n  return this.toObject({ transform: false, virtuals: false });\n};\n\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nSubdocument.prototype.save = function(fn) {\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve) {\n    fn && fn();\n    resolve();\n  });\n};\n\nSubdocument.prototype.$isValid = function(path) {\n  if (this.$parent) {\n    return this.$parent.$isValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.markModified = function(path) {\n  Document.prototype.markModified.call(this, path);\n  if (this.$parent) {\n    if (this.$parent.isDirectModified(this.$basePath)) {\n      return;\n    }\n    this.$parent.markModified([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.$markValid = function(path) {\n  Document.prototype.$markValid.call(this, path);\n  if (this.$parent) {\n    this.$parent.$markValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.invalidate = function(path, err, val) {\n  Document.prototype.invalidate.call(this, path, err, val);\n  if (this.$parent) {\n    this.$parent.invalidate([this.$basePath, path].join('.'), err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError') {\n    throw err;\n  }\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nSubdocument.prototype.ownerDocument = function() {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  var parent = this.$parent;\n  if (!parent) {\n    return this;\n  }\n\n  while (parent.$parent || parent.__parent) {\n    parent = parent.$parent || parent.__parent;\n  }\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/**\n * Null-out this subdoc\n *\n * @param {Object} [options]\n * @param {Function} [callback] optional callback for compatibility with Document.prototype.remove\n */\n\nSubdocument.prototype.remove = function(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n\n  // If removing entire doc, no need to remove subdoc\n  if (!options || !options.noop) {\n    this.$parent.set(this.$basePath, null);\n    registerRemoveListener(this);\n  }\n\n  if (typeof callback === 'function') {\n    callback(null);\n  }\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.populate = function() {\n  throw new Error('Mongoose does not support calling populate() on nested ' +\n    'docs. Instead of `doc.nested.populate(\"path\")`, use ' +\n    '`doc.populate(\"nested.path\")`');\n};\n\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  var owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    owner = sub = null;\n  }\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}\n"]},"metadata":{},"sourceType":"script"}