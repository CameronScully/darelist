{"ast":null,"code":"'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function (name, context, callback) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n\n  if (!numPres) {\n    return process.nextTick(function () {\n      callback(null);\n    });\n  }\n\n  var next = function () {\n    if (currentPre >= numPres) {\n      return;\n    }\n\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(context, function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        ++currentPre;\n        next.apply(context, arguments);\n      }, function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        if (--numAsyncPres === 0) {\n          return callback(null);\n        }\n      });\n    } else if (pre.fn.length > 0) {\n      var args = [function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n\n      if (arguments.length >= 2) {\n        for (var i = 1; i < arguments.length; ++i) {\n          args.push(arguments[i]);\n        }\n      }\n\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function () {\n            callback(null);\n          });\n        }\n      }\n\n      next();\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPreSync = function (name, context) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.call(context);\n  }\n};\n\nKareem.prototype.execPost = function (name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n  var firstError = null;\n\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function () {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function () {\n    var post = posts[currentPost];\n\n    if (firstError) {\n      if (post.length === args.length + 2) {\n        post.apply(context, [firstError].concat(args).concat(function (error) {\n          if (error) {\n            firstError = error;\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n\n          next();\n        }));\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n\n        next();\n      }\n    } else {\n      if (post.length === args.length + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        return next();\n      }\n\n      if (post.length === args.length + 1) {\n        post.apply(context, args.concat(function (error) {\n          if (error) {\n            firstError = error;\n            return next();\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.apply(null, [null].concat(args));\n          }\n\n          next();\n        }));\n      } else {\n        post.apply(context, args);\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function (name, context) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n\n  for (var i = 0; i < numPosts; ++i) {\n    posts[i].call(context);\n  }\n};\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = {\n      error: error\n    };\n    var newArgs = []; // Filter out trailing undefineds\n\n    for (var i = args.length; i >= 0; --i) {\n      if (newArgs.length > 0 || args[i] !== void 0) {\n        newArgs.unshift(args[i]);\n      }\n    }\n\n    return instance.execPost(name, context, newArgs, _options, function (error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ? callback(error) : undefined;\n  }\n}\n\nKareem.prototype.wrap = function (name, fn, context, args, options) {\n  var lastArg = args.length > 0 ? args[args.length - 1] : null;\n  var argsWithoutCb = typeof lastArg === 'function' ? args.slice(0, args.length - 1) : args;\n\n  var _this = this;\n\n  var useLegacyPost;\n\n  if (typeof options === 'object') {\n    useLegacyPost = options && options.useLegacyPost;\n  } else {\n    useLegacyPost = options;\n  }\n\n  options = options || {};\n  this.execPre(name, context, function (error) {\n    if (error) {\n      return _handleWrapError(_this, error, name, context, argsWithoutCb, options, lastArg);\n    }\n\n    var end = typeof lastArg === 'function' ? args.length - 1 : args.length;\n    fn.apply(context, args.slice(0, end).concat(function () {\n      var args = arguments;\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context, args, options, lastArg);\n      } else {\n        if (useLegacyPost && typeof lastArg === 'function') {\n          lastArg.apply(context, arguments);\n        }\n\n        _this.execPost(name, context, argsWithoutError, function () {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ? lastArg(arguments[0]) : undefined;\n          }\n\n          return typeof lastArg === 'function' && !useLegacyPost ? lastArg.apply(context, arguments) : undefined;\n        });\n      }\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function (name, fn, context, options) {\n  var _this = this;\n\n  return function () {\n    var args = Array.prototype.slice.call(arguments);\n\n    _this.wrap(name, fn, context, args, options);\n  };\n};\n\nKareem.prototype.pre = function (name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({\n    fn: fn,\n    isAsync: isAsync\n  });\n  return this;\n};\n\nKareem.prototype.post = function (name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function () {\n  var n = new Kareem();\n\n  for (var key in this._pres) {\n    if (!this._pres.hasOwnProperty(key)) {\n      continue;\n    }\n\n    n._pres[key] = this._pres[key].slice();\n  }\n\n  for (var key in this._posts) {\n    if (!this._posts.hasOwnProperty(key)) {\n      continue;\n    }\n\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nmodule.exports = Kareem;","map":{"version":3,"sources":["C:/Users/SATAN/darelist/client/node_modules/kareem/index.js"],"names":["Kareem","_pres","_posts","prototype","execPre","name","context","callback","pres","numPres","length","numAsyncPres","numAsync","currentPre","asyncPresLeft","done","process","nextTick","next","pre","isAsync","fn","call","error","apply","arguments","args","i","push","execPreSync","execPost","options","posts","numPosts","currentPost","firstError","concat","post","execPostSync","_handleWrapError","instance","useErrorHandlers","_options","newArgs","unshift","undefined","wrap","lastArg","argsWithoutCb","slice","_this","useLegacyPost","end","argsWithoutError","Array","createWrapper","clone","n","key","hasOwnProperty","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function(name, context, callback) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(\n        context,\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          ++currentPre;\n          next.apply(context, arguments);\n        },\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          if (--numAsyncPres === 0) {\n            return callback(null);\n          }\n        });\n    } else if (pre.fn.length > 0) {\n      var args = [function(error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n      if (arguments.length >= 2) {\n        for (var i = 1; i < arguments.length; ++i) {\n          args.push(arguments[i]);\n        }\n      }\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function() {\n            callback(null);\n          });\n        }\n      }\n      next();\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPreSync = function(name, context) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.call(context);\n  }\n};\n\nKareem.prototype.execPost = function(name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  var firstError = null;\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost];\n\n    if (firstError) {\n      if (post.length === args.length + 2) {\n        post.apply(context, [firstError].concat(args).concat(function(error) {\n          if (error) {\n            firstError = error;\n          }\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n          next();\n        }));\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n        next();\n      }\n    } else {\n      if (post.length === args.length + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        return next();\n      }\n      if (post.length === args.length + 1) {\n        post.apply(context, args.concat(function(error) {\n          if (error) {\n            firstError = error;\n            return next();\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.apply(null, [null].concat(args));\n          }\n\n          next();\n        }));\n      } else {\n        post.apply(context, args);\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function(name, context) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n\n  for (var i = 0; i < numPosts; ++i) {\n    posts[i].call(context);\n  }\n};\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = { error: error };\n    var newArgs = [];\n    // Filter out trailing undefineds\n    for (var i = args.length; i >= 0; --i) {\n      if (newArgs.length > 0 || args[i] !== void 0) {\n        newArgs.unshift(args[i]);\n      }\n    }\n    return instance.execPost(name, context, newArgs, _options, function(error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ?\n      callback(error) :\n      undefined;\n  }\n}\n\nKareem.prototype.wrap = function(name, fn, context, args, options) {\n  var lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  var argsWithoutCb = typeof lastArg === 'function' ?\n    args.slice(0, args.length - 1) :\n    args;\n  var _this = this;\n\n  var useLegacyPost;\n  if (typeof options === 'object') {\n    useLegacyPost = options && options.useLegacyPost;\n  } else {\n    useLegacyPost = options;\n  }\n  options = options || {};\n\n  this.execPre(name, context, function(error) {\n    if (error) {\n      return _handleWrapError(_this, error, name, context, argsWithoutCb,\n        options, lastArg)\n    }\n\n    var end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n\n    fn.apply(context, args.slice(0, end).concat(function() {\n      var args = arguments;\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context,\n          args, options, lastArg);\n      } else {\n        if (useLegacyPost && typeof lastArg === 'function') {\n          lastArg.apply(context, arguments);\n        }\n\n        _this.execPost(name, context, argsWithoutError, function() {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ?\n              lastArg(arguments[0]) :\n              undefined;\n          }\n\n          return typeof lastArg === 'function' && !useLegacyPost ?\n            lastArg.apply(context, arguments) :\n            undefined;\n        });\n      }\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function(name, fn, context, options) {\n  var _this = this;\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, context, args, options);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({ fn: fn, isAsync: isAsync });\n\n  return this;\n};\n\nKareem.prototype.post = function(name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  var n = new Kareem();\n  for (var key in this._pres) {\n    if (!this._pres.hasOwnProperty(key)) {\n      continue;\n    }\n    n._pres[key] = this._pres[key].slice();\n  }\n  for (var key in this._posts) {\n    if (!this._posts.hasOwnProperty(key)) {\n      continue;\n    }\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nmodule.exports = Kareem;\n"]},"metadata":{},"sourceType":"script"}